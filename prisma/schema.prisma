generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url = env("DATABASE_URL")
}

model User {
  id  Int @default(autoincrement()) @id
  email String  @unique
  
  name  String?
  role String @default("user")
  description String? 

  content Content[]
  uploadQuota UploadQuota?

  subscriptions Subscription[]
  playHistory PlayHistory?

  @@map("users")
}

model Subscription {
  id Int @default(autoincrement()) @id
  user User @relation(fields: [userId], references: [id])
  userId Int @map("user_id")

  subscriberId Int @map("subscriber_id")
  
  createdAt Int @default(946684800) @map("created_at")

  @@unique([userId, subscriberId])
  @@map("subscription") 
}

model Content {
  id  Int @default(autoincrement()) @id
  user User @relation(fields: [userId], references: [id])
  userId Int @map("user_id")

  title String
  description String
  duration Int? 
  
  mediaType String?  @map("media_type")
  source String

  categories Category[]

  ord Int
  createdAt Int @default(946684800) @map("created_at")

  playHistory PlayHistory[]

  @@map("contents") 
}

model Category {
  id Int @default(autoincrement()) @id 
  name String @unique
  contents Content[]

  @@map("categories")
}

model UploadQuota {
  id  Int @default(autoincrement()) @id 
  user User @relation(fields: [quotaId], references: [id])
  quotaId Int @map("quota_id")

  count Int @default(5) @map("count")
  uploadedAt Int @default(946684800) @map("uploaded_at")

  @@map("upload_quota") 
}

model PlayHistory {
  id Int @default(autoincrement()) @id
  user User @relation(fields: [historyId], references: [id])
  content Content @relation(fields: [contentId], references: [id])

  historyId Int @map("history_id")
  contentId Int @map("content_id")

  playedAt Int @map("played_at")
  createdAt Int @map("created_at")

  @@map("play_history")
}
